name: Spam Commits

on:
  push:
    branches:
      - main

jobs:
  spam_commits:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Configure Git
        run: |
          git config user.name "eschan145"
          git config user.email "eschan145@users.noreply.github.com"

      - name: Authenticate with GitHub Token
        env:
          TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          git remote set-url origin https://eschan145:$TOKEN@github.com/${{ github.repository }}.git

      - name: Spam Commits
        run: |
          for i in {1..30000}
          do
            touch spam_commit_$i.txt            # Create an empty file
            git add spam_commit_$i.txt          # Stage the file
            git commit -m "Spam commit $i"      # Commit the file
            rm spam_commit_$i.txt               # Delete the file
            git add spam_commit_$i.txt          # Stage the deletion
            git commit -m "Remove spam_commit_$i" # Commit the deletion
          done
          git push https://$GH_PAT@github.com/eschan145/farm.git --force
        env:
          # A GitHub PAT must be set up as an Actions secret in the repository
          GH_PAT: ${{ secrets.GH_PAT }}
